<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIRE ê³„ì‚°ê¸°</title>
</head>
    <body>

        <style>

            .containerfire {
                margin: 5;
                box-sizing: border-box;


                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 95vh;

                max-width: 2400px;
                margin: 0 auto;
                background: white;
                border-radius: 20px;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                padding: 10px;
            }

            .containerfire h1 {
                text-align: center;
                color: #667eea;
                margin-bottom: 10px;
                font-size: 2.5em;
            }

            .containerfire .input-section {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
                gap: 20px;
                margin-bottom: 5px;
                padding: 5px;
                background: #f8f9fa;
                border-radius: 5px;
            }

            .containerfire .input-group {
                display: flex;
                flex-direction: column;
            }

            .containerfire label {
                font-weight: 600;
                margin-bottom: 8px;
                color: #495057;
                font-size: 0.95em;
            }

            .containerfire input {
                padding: 12px;
                border: 2px solid #dee2e6;
                border-radius: 8px;
                font-size: 16px;
                transition: all 0.3s;
            }

            .containerfire input:focus {
                outline: none;
                border-color: #667eea;
                box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            }

            .containerfire .calculate-btn {
                grid-column: 1 / -1;
                padding: 15px 30px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border: none;
                border-radius: 10px;
                font-size: 18px;
                font-weight: 600;
                cursor: pointer;
                transition: transform 0.2s, box-shadow 0.2s;
                margin-top: 10px;
            }

            .containerfire .calculate-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
            }

            .containerfire .calculate-btn:active {
                transform: translateY(0);
            }

            .containerfire .error {
                background: #fee;
                border: 2px solid #fcc;
                color: #c33;
                padding: 15px;
                border-radius: 10px;
                margin-bottom: 20px;
                text-align: center;
                font-weight: 600;
            }

            .containerfire .table-container {
                overflow-x: auto;
                border-radius: 15px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            }

            .containerfire table {
                width: 100%;
                border-collapse: collapse;
                background: white;
            }

            .containerfire th {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 15px;
                text-align: center;
                font-weight: 600;
                font-size: 0.9em;
            }

            .containerfire td {
                padding: 12px;
                text-align: right;
                border-bottom: 1px solid #e9ecef;
            }

            .containerfire td:first-child {
                text-align: center;
                font-weight: 600;
                color: #667eea;
            }

            .containerfire tr:hover {
                background: #f8f9fa;
            }

            .containerfire .fire-yes {
                background: #d4edda !important;
                font-weight: 700;
                color: #155724;
            }

            .containerfire .fire-no {
                color: #721c24;
            }

            .containerfire .number {
                font-family: 'Courier New', monospace;
            }

            .containerfire table {
                font-size: 0.85em;
            }
    /* ğŸŒŸ ì²« ë²ˆì§¸ ì»¬ëŸ¼ ê³ ì • í•µì‹¬ ìŠ¤íƒ€ì¼ ğŸŒŸ */
            .containerfire th:first-child,
            .containerfire td:first-child {
                position: sticky; /* ê³ ì • ìœ„ì¹˜ ì„¤ì • */
                left: 0; /* ì™¼ìª½ ëì— ê³ ì • */
                z-index: 2; /* ìŠ¤í¬ë¡¤ë˜ëŠ” ë‹¤ë¥¸ ì…€ ìœ„ì— í‘œì‹œ */

            }

            /* í—¤ë” ì…€ ê³ ì • ì‹œ ë°°ê²½ê³¼ ê·¸ë¦¼ì ì„¤ì • */
            .containerfire th:first-child {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); /* ë°°ê²½ìƒ‰ ìœ ì§€ */
                box-shadow: 2px 0 3px rgba(0, 0, 0, 0.1); /* ê³ ì • ê²½ê³„ì— ê·¸ë¦¼ì ì¶”ê°€ */
            }

            /* ë°ì´í„° ì…€ ê³ ì • ì‹œ ë°°ê²½ê³¼ ê·¸ë¦¼ì ì„¤ì • */
            .containerfire td:first-child {
                background-color: #f8f9fa; /* ë°°ê²½ìƒ‰: í…Œì´ë¸” ë°°ê²½ê³¼ ë¹„ìŠ·í•˜ê²Œ ì„¤ì • */
                box-shadow: 2px 0 3px rgba(0, 0, 0, 0.1);
            }

            /* 0ë…„ì°¨ í–‰ì˜ ê³ ì •ëœ ì…€ì— ëŒ€í•œ ë°°ê²½ ì²˜ë¦¬ */
            .containerfire #resultBody tr:first-child td:first-child {
                background-color: white;
            }

            /* FIRE ë‹¬ì„± í–‰ì˜ ë°°ê²½ìƒ‰ê³¼ ê³ ì • ì…€ì˜ ë°°ê²½ìƒ‰ í†µì¼ */
            .containerfire .fire-yes td:first-child {
                background-color: #d4edda !important;
            }

            .containerfire .explain {
                text-align: left;
                color: #6c757d;
                margin-top: 10px;
                font-size: 0.85em;
            }
        </style>
        <div class="containerfire">
            <h1>ğŸ”¥ FIRE ê³„ì‚°ê¸°</h1>

            <div class="input-section">
                <div class="input-group">
                    <label for="income">ìˆ˜ì… (ë§Œì›)</label>
                    <input type="number" id="income" value="650" step="1" oninput="calculate()">
                </div>

                <div class="input-group">
                    <label for="expense">ì§€ì¶œ (ë§Œì›)</label>
                    <input type="number" id="expense" value="350" step="1" oninput="calculate()">
                </div>

                <div class="input-group">
                    <label for="incomeRate">ìˆ˜ì…ìƒìŠ¹ë¥ </label>
                    <input type="number" id="incomeRate" value="1.05" step="0.01" oninput="calculate()">
                </div>

                <div class="input-group">
                    <label for="inflationRate">ë¬¼ê°€ìƒìŠ¹ë¥ </label>
                    <input type="number" id="inflationRate" value="1.03" step="0.001" oninput="calculate()">
                </div>

                <div class="input-group">
                    <label for="assets">ê¸°ì¡´ìì‚° (ë§Œì›)</label>
                    <input type="number" id="assets" value="19000" step="100" oninput="calculate()">
                </div>

                <div class="input-group">
                    <label for="assetReturn">ìì‚°ìˆ˜ìµë¥ </label>
                    <input type="number" id="assetReturn" value="1.06" step="0.001" oninput="calculate()">
                </div>

                <button class="calculate-btn" onclick="calculate()">ê³„ì‚°í•˜ê¸°</button>
            </div>

            <div id="error" style="display:none;" class="error"></div>
            <div id="explainadd" class="explain"><h6>ìˆ˜ì…, ì§€ì¶œ:ë°˜ì˜¬ë¦¼í•˜ì—¬ í‘œì‹œ (ë§Œì›)<br> í•„ìš” ìì‚°: 4%rule ì ìš©</h6></div>

            <div class="table-container">
                <table id="resultTable">
                    <thead>
                        <tr>
                            <th>ì—°ì°¨</th>
                            <th>ìˆ˜ì…</th>
                            <th>ì§€ì¶œ</th>
                            <th>ì›” ì €ì¶•</th>
                            <th>ìì‚°ë³€í™”</th>
                            <th>ì €ì¶•+ìì‚°</th>
                            <th>ì€í‡´í•„ìš”ìì‚°</th>
                            <th>FIREì—¬ë¶€</th>
                        </tr>
                    </thead>
                    <tbody id="resultBody">
                    </tbody>
                </table>
            </div>
        </div>

        <script>
            function formatNumber(num) {
                return Math.round(num * 100) / 100;
            }

            function setInitialValuesFromURL() {
                const urlParams = new URLSearchParams(window.location.search);
                // ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ì™€ í•´ë‹¹ input í•„ë“œì˜ ID ë§¤í•‘
                const paramMap = {
                    'income_param': 'income',
                    'expense_param': 'expense',
                    'income_rate_param': 'incomeRate',
                    'inflation_rate_param': 'inflationRate',
                    'assets_param': 'assets',
                    'asset_return_param': 'assetReturn'
                };

                for (const paramName in paramMap) {
                    const inputId = paramMap[paramName];
                    const paramValue = urlParams.get(paramName);

                    if (paramValue !== null && paramValue.trim() !== '' && !isNaN(paramValue)) {
                        // ê°’ì´ ìœ íš¨í•˜ë©´ í•´ë‹¹ input í•„ë“œì— ì„¤ì •
                        document.getElementById(inputId).value = paramValue;
                    }
                }
            }

            function calculate() {
                const income = parseFloat(document.getElementById('income').value);
                const expense = parseFloat(document.getElementById('expense').value);
                const incomeRate = parseFloat(document.getElementById('incomeRate').value);
                const inflationRate = parseFloat(document.getElementById('inflationRate').value);
                const initialAssets = parseFloat(document.getElementById('assets').value);
                const assetReturn = parseFloat(document.getElementById('assetReturn').value);

                const errorDiv = document.getElementById('error');
                const resultBody = document.getElementById('resultBody');

                // ì—ëŸ¬ ì²´í¬
                if (inflationRate >= assetReturn) {
                    errorDiv.textContent = 'âš ï¸ ë¬¼ê°€ìƒìŠ¹ë¥ ì´ ìì‚°ìˆ˜ìµë¥ ë³´ë‹¤ ë†’ê±°ë‚˜ ê°™ìœ¼ë©´ FIREê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤!';
                    errorDiv.style.display = 'block';
                    resultBody.innerHTML = '';
                    return;
                }


                errorDiv.style.display = 'none';
                resultBody.innerHTML = '';

                let currentIncome = income;
                let currentExpense = expense;
                let currentAssets = initialAssets;
                let fireYear = -1;
                let requiredMonth = 12;

                // 0ë…„ì°¨ ê³„ì‚°
                const requiredAssets0 = expense * 12 / (assetReturn - 1);
                const isFire0 = currentAssets >= requiredAssets0;

                if (isFire0) {
                    fireYear = 0;
                }

                // 0ë…„ì°¨ í–‰ ì¶”ê°€
                const row0 = resultBody.insertRow();
                row0.innerHTML = `
                    <td>0ë…„</td>
                    <td class="number">-</td>
                    <td class="number">-</td>
                    <td class="number">-</td>
                    <td class="number">-</td>
                    <td class="number">${formatNumber(currentAssets).toLocaleString()}</td>
                    <td class="number">${formatNumber(requiredAssets0).toLocaleString()}</td>
                    <td class="${isFire0 ? 'fire-yes' : 'fire-no'}">${isFire0 ? 'FIRE!' : '-'}</td>
                `;

                // ìµœëŒ€ 50ë…„ê¹Œì§€ ê³„ì‚°í•˜ë˜, FIRE ë‹¬ì„± í›„ 1ë…„ê¹Œì§€ë§Œ í‘œì‹œ
                let yearsPastFire = 0;

                for (let year = 1; year <= 50; year++) {
                    currentIncome = formatNumber(income * Math.pow(incomeRate, year));
                    currentExpense = formatNumber(expense * Math.pow(inflationRate, year));

                    const monthlySavings = formatNumber(currentIncome - currentExpense);
                    const assetGrowth = formatNumber(currentAssets * assetReturn);
                    const totalAssets = formatNumber(assetGrowth + monthlySavings * 12);
                    const requiredAssets = formatNumber(currentExpense * 12 / (assetReturn - 1));

                    const isFire = totalAssets >= requiredAssets;

                    if (isFire && fireYear === -1) {
                        fireYear = year;
                    }

                    // FIRE ë‹¬ì„± í›„ 1ë…„ê¹Œì§€ë§Œ í‘œì‹œ
                    if (fireYear !== -1 && year > fireYear) {
                        yearsPastFire++;
                        if (yearsPastFire > 1) {
                            break;
                        }
                    }


                    // ìµœì†Œ 5ë…„ì€ í‘œì‹œ
                    if (year <= 5 || fireYear === -1 || year <= fireYear + 1) {
                        const row = resultBody.insertRow();

                        const roundedCurrentIncome = Math.round(currentIncome); // ë°˜ì˜¬ë¦¼
                        const roundedCurrentExpense = Math.round(currentExpense); // ë°˜ì˜¬ë¦¼
                        const roundedMonthlySavings = Math.round(monthlySavings); // ë°˜ì˜¬ë¦¼
                        const roundedAssetGrowth = Math.round(assetGrowth); // ë°˜ì˜¬ë¦¼
                        const roundedTotalAssets = Math.round(totalAssets); // ë°˜ì˜¬ë¦¼
                        const roundedRequiredAssets = Math.round(requiredAssets); // ë°˜ì˜¬ë¦¼
                        /*
                        console.log(year);
                        console.log((currentAssets)  - requiredAssets)
                        console.log(currentAssets);
                        console.log(monthlySavings);
                        console.log("_______");
                        */

                        let monthlyassets = currentAssets;
                        for(let imonth=0; imonth<12; imonth++){
                            monthlyassets = monthlyassets * (1+ (assetReturn-1)/12) + monthlySavings;
                            //console.log(imonth + ": " + monthlyassets + " / " + requiredAssets);
                            if((monthlyassets >= requiredAssets) & (fireYear === year)){
                                //console.log("ëª©í‘œ ë‹¬ì„±!" + (imonth+1) + "ê°œì›”ì°¨");
                                requiredMonth = imonth + 1;
                                console.log(requiredMonth)
                                break;
                            }
                        }
                        // console.log(requiredMonth)
                        const addtext = year === fireYear ? "<br>" + requiredMonth +"ê°œì›”ë¶€í„°" : "";

                        row.innerHTML = `
                            <td>${year}ë…„</td>
                            <td class="number">${roundedCurrentIncome.toLocaleString()}</td>
                            <td class="number">${roundedCurrentExpense.toLocaleString()}</td>
                            <td class="number">${roundedMonthlySavings.toLocaleString()}</td>
                            <td class="number">${roundedAssetGrowth.toLocaleString()}</td>
                            <td class="number">${roundedTotalAssets.toLocaleString()}</td>
                            <td class="number">${roundedRequiredAssets.toLocaleString()}</td>
                            <td class="${isFire ? 'fire-yes' : 'fire-no'}">${isFire ? 'FIRE!' + addtext  : 'ì¶œê·¼'}</td>
                        `;
                    }

                    currentAssets = totalAssets;
                }


                if (fireYear === -1) {
                    errorDiv.textContent = 'âš ï¸ 50ë…„ ì´ë‚´ FIREê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤!';
                    errorDiv.style.display = 'block';
                    // 50ë…„ì´ ì§€ë‚˜ë„ FIREê°€ ì•ˆ ë˜ë©´ ë§ˆì§€ë§‰ í–‰ ì¶”ê°€
                    const finalRow = resultBody.insertRow();
                    finalRow.innerHTML = `
                        <td>50ë…„</td>
                        <td class="number">${Math.round(currentIncome).toLocaleString()}</td>
                        <td class="number">${Math.round(currentExpense).toLocaleString()}</td>
                        <td class="number">${Math.round(monthlySavings).toLocaleString()}</td>
                        <td class="number">${Math.round(assetGrowth).toLocaleString()}</td>
                        <td class="number">${Math.round(currentAssets).toLocaleString()}</td>
                        <td class="number">${Math.round(requiredAssets).toLocaleString()}</td>
                        <td class="fire-no">ì¶œê·¼</td>
                    `;
                } else if (fireYear > 0) {
                    errorDiv.textContent = `ğŸ‰ FIRE ë‹¬ì„± ì˜ˆìƒ ì—°ì°¨: ${fireYear}ë…„ì°¨! (${requiredMonth} ê°œì›”ë¶€í„°)`;
                    errorDiv.style.display = 'block';
                } else if (fireYear === 0) {
                    errorDiv.textContent = `ğŸ’° ì´ë¯¸ FIREë¥¼ ë‹¬ì„±í•˜ì…¨ìŠµë‹ˆë‹¤! (0ë…„ì°¨)`;
                    errorDiv.style.display = 'block';
                }
            }

            // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ê³„ì‚°
            window.onload = () =>{
                setInitialValuesFromURL();
                calculate();
            }


        </script>
    </body>
</html>
